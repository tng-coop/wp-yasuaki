@* Modal media picker owned by Blazor. Shows WP thumbnails, paging, single-select → returns HTML *@
@using System.Net
@using System.Text.Json
@using Editor.WordPress

@if (_visible)
{
  <div class="mp-backdrop" @onclick="Cancel"></div>
  <div class="mp-modal" role="dialog" aria-modal="true" aria-label="Media Library">
    <div class="mp-header">
      <h3 class="m-0">Media Library</h3>
      <button class="btn-close" @onclick="Cancel" aria-label="Close"></button>
    </div>

    <div class="mp-body">
      @if (_error is not null)
      {
        <div class="alert alert-danger mb-2">@_error</div>
      }

      <div class="mp-grid">
        @if (_items.Count == 0 && _busy)
        {
          <div class="text-muted p-3">Loading…</div>
        }
        else if (_items.Count == 0)
        {
          <div class="text-muted p-3">No media</div>
        }
        else
        {
          @foreach (var i in _items)
          {
            var selected = _selected?.id == i.id;
            <button type="button" class="mp-tile @(selected ? "selected" : null)"
                    title="@AltOrTitle(i)"
                    @onclick="() => Select(i)"
                    @ondblclick="Confirm">
              @if (!string.IsNullOrEmpty(Thumb(i)))
              {
                <img src="@Thumb(i)" alt="@AltOrTitle(i)" />
              }
              else
              {
                <div class="mp-placeholder">@i.mime_type</div>
              }
              @if (IsPdf(i)) { <span class="mp-badge">PDF</span> }
            </button>
          }
        }
      </div>
    </div>

    <div class="mp-footer">
      <div class="d-flex align-items-center gap-2 w-100">
        <button class="btn btn-outline-secondary btn-sm"
                disabled="@(_busy || _page >= _totalPages)"
                @onclick="LoadMore">Load more</button>
        <small class="text-muted">Page @_page / @_totalPages</small>
        <span class="flex-grow-1"></span>
        <button class="btn btn-outline-secondary btn-sm" @onclick="Cancel">Cancel</button>
        <button class="btn btn-primary btn-sm" disabled="@(_selected is null)" @onclick="Confirm">Insert</button>
      </div>
    </div>
  </div>
}
